"use strict";function LoadMapServer(e){var t=window.Marzipano,s=window.bowser,a=window.screenfull,o=e,n=document.querySelector("#pano"),i=document.querySelector("#titleBar .sceneName"),r=document.querySelector("#sceneList"),l=document.querySelectorAll("#sceneList .scene"),d=document.querySelector("#sceneListToggle"),c=document.querySelector("#autorotateToggle"),p=document.querySelector("#fullscreenToggle");if(window.matchMedia){var v=function(){u.matches?(document.body.classList.remove("desktop"),document.body.classList.add("mobile")):(document.body.classList.remove("mobile"),document.body.classList.add("desktop"))},u=matchMedia("(max-width: 500px), (max-height: 500px)");v(),u.addListener(v)}else document.body.classList.add("desktop");document.body.classList.add("no-touch"),window.addEventListener("touchstart",function(){document.body.classList.remove("no-touch"),document.body.classList.add("touch")}),s.msie&&11>parseFloat(s.version)&&document.body.classList.add("tooltip-fallback");var h={controls:{mouseViewMode:o.settings.mouseViewMode}},m=new t.Viewer(n,h),f=o.scenes.map(function(e){var s="tiles",a=t.ImageUrlSource.fromString(s+"/"+e.id+"/{z}/{f}/{y}/{x}.jpg",{cubeMapPreviewUrl:s+"/"+e.id+"/preview.jpg"}),n=new t.CubeGeometry(e.levels),i=t.RectilinearView.limit.traditional(e.faceSize,100*Math.PI/180,120*Math.PI/180),r=new t.RectilinearView(e.initialViewParameters,i),l=m.createScene({source:a,geometry:n,view:r,pinFirstLevel:!0});return e.linkHotspots.forEach(function(e){var t=function e(t){var s=document.createElement("div");s.classList.add("hotspot"),s.classList.add("link-hotspot");var a=document.createElement("img");a.src="img/link-final.png",a.classList.add("link-hotspot-icon");for(var n=["-ms-transform","-webkit-transform","transform"],i=0;i<n.length;i++){var r=n[i];a.style[r]="rotate("+t.rotation+"rad)"}s.addEventListener("click",function(){C(function e(t){for(var s=0;s<f.length;s++)if(f[s].data.id===t)return f[s];return null}(t.target))}),P(s);var l=document.createElement("div");return l.classList.add("hotspot-tooltip"),l.classList.add("link-hotspot-tooltip"),l.innerHTML=function e(t){for(var s=0;s<o.scenes.length;s++)if(o.scenes[s].id===t)return o.scenes[s];return null}(t.target).name,s.appendChild(a),s.appendChild(l),s}(e);l.hotspotContainer().createHotspot(t,{yaw:e.yaw,pitch:e.pitch})}),e.infoHotspots.forEach(function(e){var t=function e(t){var s=document.createElement("div");s.classList.add("hotspot"),s.classList.add("info-hotspot");var a=document.createElement("div");a.classList.add("info-hotspot-header");var o=document.createElement("div");o.classList.add("info-hotspot-icon-wrapper");var n=document.createElement("img");switch(t.estado){case void 0:case"DISPONIBLE":n.src="img/lote-disponible.svg";break;default:n.src="img/lote-vendido.svg"}n.classList.add("info-hotspot-icon"),o.appendChild(n);var i=document.createElement("div");i.classList.add("info-hotspot-title-wrapper");var r=document.createElement("div");r.classList.add("info-hotspot-title");var l=t.estado;void 0==l&&(l="VENDIDO"),r.innerHTML=l,i.appendChild(r);var d=document.createElement("div");d.classList.add("info-hotspot-close-wrapper");var c=document.createElement("img");c.src="img/close.png",c.classList.add("info-hotspot-close-icon"),d.appendChild(c),a.appendChild(o),a.appendChild(i),a.appendChild(d);var p=document.createElement("div");p.classList.add("info-hotspot-text"),"Text"==t.text&&(t.text="--"),p.innerHTML='<div class="info">'+t.text+"</div>",s.appendChild(a),s.appendChild(p);var v=document.createElement("div");v.innerHTML=s.innerHTML,v.classList.add("info-hotspot-modal"),document.body.appendChild(v);var u=function(){s.classList.toggle("visible"),v.classList.toggle("visible")};return s.querySelector(".info-hotspot-header").addEventListener("click",u),v.querySelector(".info-hotspot-close-wrapper").addEventListener("click",u),P(s),s}(e);l.hotspotContainer().createHotspot(t,{yaw:e.yaw,pitch:e.pitch})}),{data:e,scene:l,view:r}}),L=t.autorotate({yawSpeed:.03,targetPitch:0,targetFov:Math.PI/2});o.settings.autorotateEnabled&&c.classList.add("enabled"),c.addEventListener("click",function e(){c.classList.contains("enabled")?(c.classList.remove("enabled"),q()):(c.classList.add("enabled"),k())}),a.enabled&&o.settings.fullscreenButton?(document.body.classList.add("fullscreen-enabled"),p.addEventListener("click",function(){a.toggle()}),a.on("change",function(){a.isFullscreen?p.classList.add("enabled"):p.classList.remove("enabled")})):document.body.classList.add("fullscreen-disabled"),d.addEventListener("click",function e(){r.classList.toggle("enabled"),d.classList.toggle("enabled")}),document.body.classList.contains("mobile")||(r.classList.add("enabled"),d.classList.add("enabled")),f.forEach(function(e){document.querySelector('#sceneList .scene[data-id="'+e.data.id+'"]').addEventListener("click",function(){C(e),document.body.classList.contains("mobile")&&(r.classList.remove("enabled"),d.classList.remove("enabled"))})});var g=document.querySelector("#viewUp"),w=document.querySelector("#viewDown"),b=document.querySelector("#viewLeft"),y=document.querySelector("#viewRight"),E=document.querySelector("#viewIn"),M=document.querySelector("#viewOut"),S=m.controls();function C(e){var t,s,a;$(".here-icon").css("transform","rotate("+e.data.point_init+"deg)"),t=e.data.point,$(".map-360 figure").css("top",t.top),$(".map-360 figure").css("left",t.left),q(),e.view.setParameters(e.data.initialViewParameters),e.scene.switchTo(),k(),s=e,i.innerHTML=(a=s.data.name).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;"),function e(t){for(var s=0;s<l.length;s++){var a=l[s];a.getAttribute("data-id")===t.data.id?a.classList.add("current"):a.classList.remove("current")}}(e)}function k(){c.classList.contains("enabled")&&(m.startMovement(L),m.setIdleMovement(3e3,L))}function q(){m.stopMovement(),m.setIdleMovement(1/0)}function P(e,t){for(var t=["touchstart","touchmove","touchend","touchcancel","wheel","mousewheel"],s=0;s<t.length;s++)e.addEventListener(t[s],function(e){e.stopPropagation()})}S.registerMethod("upElement",new t.ElementPressControlMethod(g,"y",-.7,3),!0),S.registerMethod("downElement",new t.ElementPressControlMethod(w,"y",.7,3),!0),S.registerMethod("leftElement",new t.ElementPressControlMethod(b,"x",-.7,3),!0),S.registerMethod("rightElement",new t.ElementPressControlMethod(y,"x",.7,3),!0),S.registerMethod("inElement",new t.ElementPressControlMethod(E,"zoom",-.7,3),!0),S.registerMethod("outElement",new t.ElementPressControlMethod(M,"zoom",.7,3),!0),C(f[0])}$(document).ready(function(){var e=new Date().valueOf(),t=window.location.href;$.getJSON(t+"/data-copia.js?v="+e,function(e){LoadMapServer(e)})});
